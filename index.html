<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=0.5">
        <title>The Autonomous Terminal - Commands of wisdom and nonsense</title>
        <meta name="keywords" content="autonomous terminal, command line, jokes, fortune">

        <script src="jquery-3.5.1.min.js"></script>
        <script src="autoterm.js"></script>
        <script>
         var autoterm = null;
         var first = true;
         var defaultPrompt = '$ ';

         function isOverflowing() {
             var pageElem = $('html').get(0);
             return pageElem.clientHeight < pageElem.scrollHeight;
         }

         function scrollToBottom() {
             var pageElem = $('html').get(0);
             window.scrollTo(0, pageElem.scrollHeight);
         }

         function fetchNextCmd() {
             if (!autoterm) return false;

             if (first) {
                 first = false;
                 autoterm.exec(
                     '^S9# Autonomous terminal at my service. Stay away from keyboard, thank you.\n',
                     '', 1500);
                 setTimeout(fetchNextCmd, 1000);
                 return true;
             }

             scrollToBottom();

             if (autoterm.busy) {
                 setTimeout(fetchNextCmd, 1000);
                 return true;
             }

             if (isOverflowing()) {
                 autoterm.clear();
             }

             var fetchUrl = 'cmd.cgi';
             var nextPause = 3000;

             if (window.location.hash) {
                 fetchUrl += ('?' + window.location.hash.substring(1));
             } else if (Math.random() < 0.35) {
                 fetchUrl += '?fortune';
                 nextPause = 6000; // give time to ponder
             }

             $.ajax(fetchUrl, {
                 cache: false,
                 dataType: 'text',
                 success: function(data) {
                     autoterm.exec(data, defaultPrompt, nextPause);
                     setTimeout(fetchNextCmd, 1000);
                 }
             });
         }

         $(document).ready(function() {
             autoterm = new AutoTerm($('#autoterm').get(0));
             fetchNextCmd();
         });
        </script>
        <style>
         body { background-color: black; color: white;  }
         #icon { position: fixed; top: 0px; right: 0px; margin: 1em }
         .bubble { color: white; font-style: italic; }
         #content { position: absolute; top: 0; left: 0; }
         #autoterm {
             color: #00fa9a;
             padding-left: 1em;
             border-style: none;
             font-size: 1.1rem;
         }
        </style>
    </head>

    <body>
        <img id="icon" src="autoterm.png" alt="Terminal emulator icon">

        <div id="content">

            <pre id="autoterm"></pre>

        </div>
    </body>
</html>
